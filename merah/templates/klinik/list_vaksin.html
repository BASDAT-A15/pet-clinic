{% extends 'base.html' %}
{% load humanize %}
{% load static %}

{% block meta %}
<title>List Vaccine</title>
{% endblock meta %}
{% block content %}
<div class="container mx-auto px-4 py-8">
    <h1 class="text-2xl font-bold mb-6">List Vaccine</h1>
    
    <style>
        /* Additional styling for better appearance */
        table {
            border-collapse: collapse;
            width: 100%;
        }
        th, td {
            border: 1px solid #e2e8f0;
        }
        th {
            background-color: #f7fafc;
            font-weight: 600;
        }
        tr:nth-child(even) {
            background-color: #f8fafc;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 0.5rem;
            max-width: 500px;
            width: 100%;
        }
    </style>

    <!-- Search Box -->
    <div class="mb-4">
        <input type="text" 
               id="searchVaccine" 
               placeholder="Search Vaccine Name" 
               class="border p-2 rounded w-full md:w-1/3 focus:outline-none focus:ring-2 focus:ring-blue-500">
    </div>
    
    <!-- Vaccine Table -->
    <div class="overflow-x-auto bg-white rounded-lg shadow">
        <table class="min-w-full">
            <thead class="bg-gray-100">
                <tr>
                    <th class="py-3 px-4 border text-left">No</th>
                    <th class="py-3 px-4 border text-left">ID Vaksin</th>
                    <th class="py-3 px-4 border text-left">Nama Vaksin</th>
                    <th class="py-3 px-4 border text-left">Harga</th>
                    <th class="py-3 px-4 border text-left">Stok</th>
                    <th class="py-3 px-4 border text-left">Action</th>
                </tr>
            </thead>
            <tbody>
                {% for vaksin in vaksin_list %}
                <tr class="hover:bg-gray-50">
                    <td class="py-3 px-4 border">{{ forloop.counter }}</td>
                    <td class="py-3 px-4 border">{{ vaksin.kode_vaksin }}</td>
                    <td class="py-3 px-4 border">{{ vaksin.nama_vaksin }}</td>
                    <td class="py-3 px-4 border">Rp{{ vaksin.harga|intcomma }}</td>
                    <td class="py-3 px-4 border">{{ vaksin.stok }}</td>
                    <td class="py-3 px-4 border">
                        <div class="flex space-x-2">
                            <!-- Update Stock Button -->
                            <a href="{% url 'merah:update_stok_vaksin' vaksin.kode_vaksin %}" 
                               class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm transition">
                                Update Stock
                            </a>
                            
                            <!-- Update Button -->
                            <a href="{% url 'merah:update_vaksin' vaksin.kode_vaksin %}" 
                               class="bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-1 rounded text-sm transition">
                                Update
                            </a>
                            
                            <!-- Delete Button  -->
                            {% if vaksin.can_delete %}
                            <button onclick="showDeleteModal('{{ vaksin.kode_vaksin }}', '{{ vaksin.nama_vaksin }}')" 
                                class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm transition">
                                Delete
                            </button>
                            {% endif %}
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
    <!-- Add New Vaccine Button -->
    <div class="mt-6">
        <a href="{% url 'merah:add_vaksin' %}" 
           class="inline-flex items-center px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded transition">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" />
            </svg>
            Add New Vaccine
        </a>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div id="deleteModal" class="fixed hidden inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full">
    <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
        <h3 class="text-xl font-bold mb-4">Delete Vaccine</h3>
        <p id="modalText" class="mb-6">Apakah kamu yakin ingin menghapus vaksin 
            <strong id="vaksinNama" class="text-red-600"></strong> dengan 
            <strong id="vaksinKode" class="text-red-600"></strong> ?
        </p>
        <div class="flex justify-end space-x-4">
            <button onclick="hideDeleteModal()" class="px-4 py-2 border border-gray-300 rounded">Cancel</button>
            <form id="deleteForm" method="post">
                {% csrf_token %}
                <button type="submit" class="px-4 py-2 bg-red-600 text-white rounded">Confirm Delete</button>
            </form>
        </div>
    </div>
</div>

<script>
    // Search Functionality
    document.getElementById('searchVaccine').addEventListener('input', function() {
        const searchValue = this.value.toLowerCase().trim();
        const rows = document.querySelectorAll('tbody tr');
        
        rows.forEach(row => {
            const vaccineName = row.querySelector('td:nth-child(3)').textContent.toLowerCase();
            row.style.display = vaccineName.includes(searchValue) ? '' : 'none';
        });
    });
    
    // Delete Modal Functions
    function showDeleteModal(kodeVaksin, namaVaksin) {
        document.getElementById('vaksinKode').textContent = kodeVaksin;
        document.getElementById('vaksinNama').textContent = namaVaksin;
        document.getElementById('deleteForm').action = "{% url 'merah:delete_vaksin' '0' %}".replace('0', kodeVaksin);
        document.getElementById('deleteModal').classList.remove('hidden');
    }
    
    function hideDeleteModal() {
        document.getElementById('deleteModal').classList.add('hidden');
    }
    </script>
{% endblock %}